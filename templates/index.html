<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.13.0/Sortable.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="static/custom.min.css" rel="stylesheet">
    <title>ChefGPT</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script>
        (() => {
            const getStoredTheme = () => localStorage.getItem('theme')
            const setStoredTheme = theme => localStorage.setItem('theme', theme)

            const getPreferredTheme = () => {
                const storedTheme = getStoredTheme()
                if (storedTheme) {
                    return storedTheme
                }

                return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
            }

            const setTheme = theme => {
                if (theme === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.setAttribute('data-bs-theme', 'dark')
                } else {
                    document.documentElement.setAttribute('data-bs-theme', theme)
                }
            }

            setTheme(getPreferredTheme())

            const showActiveTheme = (theme, focus = false) => {
                const themeSwitcher = document.querySelector('#user-menu')

                if (!themeSwitcher) {
                    return
                }

                const themeSwitcherText = document.querySelector('#user-menu')
                const btnToActive = document.querySelector(`[data-bs-theme-value="${theme}"]`)
                const biOfActiveBtn = btnToActive.querySelector('.bi-check')

                document.querySelectorAll('[data-bs-theme-value]').forEach(element => {
                    element.classList.remove('active')
                    element.setAttribute('aria-pressed', 'false')
                    element.querySelector('.bi-check').classList.add('d-none')
                })

                btnToActive.classList.add('active')
                biOfActiveBtn.classList.remove('d-none')
                const themeSwitcherLabel = `${themeSwitcherText.textContent} (${btnToActive.dataset.bsThemeValue})`
                themeSwitcher.setAttribute('aria-label', themeSwitcherLabel)

                if (focus) {
                    themeSwitcher.focus()
                }
            }

            window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
                const storedTheme = getStoredTheme()
                if (storedTheme !== 'light' && storedTheme !== 'dark') {
                    setTheme(getPreferredTheme())
                }
            })

            window.addEventListener('DOMContentLoaded', () => {
                showActiveTheme(getPreferredTheme())

                document.querySelectorAll('[data-bs-theme-value]')
                    .forEach(toggle => {
                        toggle.addEventListener('click', () => {
                            const theme = toggle.getAttribute('data-bs-theme-value')
                            setStoredTheme(theme)
                            setTheme(theme)
                            showActiveTheme(theme, true)
                        })
                    })
            })
        })()
    </script>
</head>

<body>
    <header class="navbar bd-gutter navbar-expand-md bg-primary-subtle">
        <nav class="container-lg bd-gutter flex-wrap flex-lg-nowrap">
            <div class="row my-1"><img style="max-width: 56px;" src="static/chef_gpt.png"><h4 class="m-auto col-auto">ChefGPT</h4></div>
            <div class="btn-group">
                <div class="dropdown me-2">
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="user-menu"><i class="bi bi-person-circle"></i> {{ username }}</button>
                    <ul class="dropdown-menu align-items-center dropdown-menu-end" aria-labelledby="user-menu">
                        <li><button data-bs-toggle="modal" data-bs-target="#propertiesModal" class="dropdown-item"><i class="bi me-2 opacity-50 bi-gear"></i>Preferences</button></li>
                    </ul>
                </div>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary" type="button" data-bs-toggle="dropdown" aria-expanded="false" id="mode-menu"><i class="bi bi-circle-half"></i></button>
                    <ul class="dropdown-menu align-items-center dropdown-menu-end" aria-labelledby="mode-menu">
                        <li><button class="dropdown-item align-items-center" aria-pressed="false" data-bs-theme-value="light"><i class="bi me-2 opacity-50 bi-sun-fill"></i>Light mode <i class="bi bi-check ms-auto d-none"></i></button></li>
                        <li><button class="dropdown-item align-items-center" aria-pressed="false" data-bs-theme-value="dark"><i class="bi me-2 opacity-50 bi-moon-stars-fill"></i>Dark mode <i class="bi bi-check ms-auto d-none"></i></button></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <!-- Properties modal -->
    <div class="modal fade" id="propertiesModal" tabindex="-1" aria-labelledby="propertiesModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="propertiesModalLabel">Properties</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="propertiesModalContent">
                    <p>Coming soon!</p>
                    <a class="btn btn-outline-danger" href="/logout">Log out</a>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-tertiary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container-lg row my-1 pb-5 px-3 mx-auto">

        <form method="POST" class="row mx-auto g-2 align-items-center" id="itemForm">
            <div class="col-sm-12 col-md-6">
                <input placeholder="Enter an item here" type="text" name="item_name" autocomplete="off" class="form-control" id="itemInput" maxlength="64" required>
            </div>
            <div class="col-md-auto d-flex gap-2">
                <button type="submit" class="btn btn-secondary flex-fill" aria-label="Add item to list"><i class="bi bi-plus-lg me-2"></i>Add item</button>
                <button type="button" data-bs-toggle="modal" data-bs-target="#deletedItemsModal" id="recentItemsBtn" class="btn btn-tertiary" aria-label="Add previously deleted items"><i class="bi bi-arrow-counterclockwise"></i></button>
            </div>
            <div class="col d-grid justify-content-end">
                <div class="btn-group" role="group" aria-label="Collapse or expand accordions">
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="accordionCollapseButton"><i class="bi bi-chevron-contract me-1"></i>Collapse</button>
                    <button type="button" class="btn btn-outline-secondary btn-sm" id="accordionExpandButton"><i class="bi bi-chevron-expand me-1"></i>Expand</button>
                </div>
            </div>
        </form>

        <div class="accordion mt-3" id="bucketsAccordion">
            <div class="accordion-item">
                <h2 class="accordion-header" id="headingUngrouped">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUngrouped" aria-expanded="true" aria-controls="collapseUngrouped">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="me-2">
                            <g clip-path="url(#clip0_20_177)">
                                <path xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" d="M5 2C4.83923 2 4.68208 2.01256 4.5293 2.03657C3.98372 2.12231 3.47192 1.74953 3.38618 1.20394C3.30044 0.65835 3.67322 0.146556 4.21881 0.0608147C4.47392 0.0207229 4.73488 0 5 0H5.5C6.05228 0 6.5 0.447715 6.5 1C6.5 1.55228 6.05228 2 5.5 2H5ZM8.5 1C8.5 0.447715 8.94772 0 9.5 0H10.5C11.0523 0 11.5 0.447715 11.5 1C11.5 1.55228 11.0523 2 10.5 2H9.5C8.94772 2 8.5 1.55228 8.5 1ZM13.5 1C13.5 0.447715 13.9477 0 14.5 0H15C15.2651 0 15.5261 0.0207229 15.7812 0.0608148C16.3268 0.146556 16.6996 0.65835 16.6138 1.20394C16.5281 1.74953 16.0163 2.12231 15.4707 2.03657C15.3179 2.01256 15.1608 2 15 2H14.5C13.9477 2 13.5 1.55228 13.5 1ZM1.20394 3.38618C1.74953 3.47192 2.12231 3.98371 2.03657 4.5293C2.01256 4.68208 2 4.83923 2 5V5.5C2 6.05228 1.55228 6.5 1 6.5C0.447715 6.5 0 6.05228 0 5.5V5C0 4.73488 0.0207229 4.47392 0.0608148 4.21881C0.146556 3.67322 0.65835 3.30044 1.20394 3.38618ZM18.7961 3.38618C19.3417 3.30044 19.8534 3.67322 19.9392 4.21881C19.9793 4.47392 20 4.73488 20 5V5.5C20 6.05228 19.5523 6.5 19 6.5C18.4477 6.5 18 6.05228 18 5.5V5C18 4.83923 17.9874 4.68208 17.9634 4.5293C17.8777 3.98372 18.2505 3.47192 18.7961 3.38618ZM1 8.5C1.55228 8.5 2 8.94771 2 9.5V10.5C2 11.0523 1.55228 11.5 1 11.5C0.447715 11.5 0 11.0523 0 10.5V9.5C0 8.94771 0.447715 8.5 1 8.5ZM19 8.5C19.5523 8.5 20 8.94772 20 9.5V10.5C20 11.0523 19.5523 11.5 19 11.5C18.4477 11.5 18 11.0523 18 10.5V9.5C18 8.94772 18.4477 8.5 19 8.5ZM1 13.5C1.55228 13.5 2 13.9477 2 14.5V15C2 15.1608 2.01256 15.3179 2.03657 15.4707C2.12231 16.0163 1.74953 16.5281 1.20394 16.6138C0.65835 16.6996 0.146556 16.3268 0.0608147 15.7812C0.0207229 15.5261 0 15.2651 0 15V14.5C0 13.9477 0.447715 13.5 1 13.5ZM19 13.5C19.5523 13.5 20 13.9477 20 14.5V15C20 15.2651 19.9793 15.5261 19.9392 15.7812C19.8534 16.3268 19.3417 16.6996 18.7961 16.6138C18.2505 16.5281 17.8777 16.0163 17.9634 15.4707C17.9874 15.3179 18 15.1608 18 15V14.5C18 13.9477 18.4477 13.5 19 13.5ZM3.38618 18.7961C3.47192 18.2505 3.98371 17.8777 4.5293 17.9634C4.68208 17.9874 4.83923 18 5 18H5.5C6.05228 18 6.5 18.4477 6.5 19C6.5 19.5523 6.05228 20 5.5 20H5C4.73488 20 4.47392 19.9793 4.21881 19.9392C3.67322 19.8534 3.30044 19.3417 3.38618 18.7961ZM16.6138 18.7961C16.6996 19.3417 16.3268 19.8534 15.7812 19.9392C15.5261 19.9793 15.2651 20 15 20H14.5C13.9477 20 13.5 19.5523 13.5 19C13.5 18.4477 13.9477 18 14.5 18H15C15.1608 18 15.3179 17.9874 15.4707 17.9634C16.0163 17.8777 16.5281 18.2505 16.6138 18.7961ZM8.5 19C8.5 18.4477 8.94771 18 9.5 18H10.5C11.0523 18 11.5 18.4477 11.5 19C11.5 19.5523 11.0523 20 10.5 20H9.5C8.94771 20 8.5 19.5523 8.5 19Z" />                            </g>
                            <defs>
                                <clipPath id="clip0_20_177">
                                    <rect width="20" height="20" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>Not grouped <span class="badge text-body bg-secondary bg-opacity-25 ms-2">{{ items_by_category['Ungrouped'] | length }}</span>
                    </button>
                </h2>
                <div id="collapseUngrouped" class="accordion-collapse collapse" aria-labelledby="headingUngrouped">
                    <div class="accordion-body p-2">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                            <button class="btn btn-outline-secondary" onclick="selectAll('Ungrouped')"><i class="bi bi-check-square me-1"></i>Select all</button>
                            <button class="btn btn-outline-secondary" onclick="selectNone('Ungrouped')"><i class="bi bi-square me-1"></i>Select none</button>
                        </div>
                        <ul class="list-group sortable-list mt-2" data-category="Ungrouped" id="Ungrouped">
                            {% for item in items_by_category['Ungrouped'] %}
                            <li class="list-group-item ps-1 d-flex align-items-center" data-id="{{ item.id }}">
                                <div class="px-2 py-1 me-1 opacity-75 dragHandle"><i class="bi bi-grip-vertical"></i></div>
                                <input class="form-check-input me-2 my-0" type="checkbox" value="{{ item.name }}" id="{{ item.id }}">
                                <label class="form-check-label flex-fill text-break" for="{{ item.id }}">{% if item.name|length > 48 %}{{ item.name[:24] }}...{% else %}{{ item.name }}{% endif %}<span class="tags-container mx-1" id="tags-{{ item.id }}"></span></label>
                                <div class="dropdown float-end mb-auto">
                                    <button class="btn btn-outline-secondary btn-sm" type="button" id="dropdownMenuButton-{{ item.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ item.id }}">
                                        <li><h6 class="dropdown-header">Tags</h6></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Fresh')" data-item-id="{{ item.id }}" data-tag="Fresh">Fresh</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Old')" data-item-id="{{ item.id }}" data-tag="Old">Old</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Frozen')" data-item-id="{{ item.id }}" data-tag="Frozen">Frozen</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Low')" data-item-id="{{ item.id }}" data-tag="Low">Low</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><button class="dropdown-item py-2" onclick="startEditItem('{{ item.id }}', event)">Edit <i class="bi bi-pencil"></i></button></li>
                                        <li><button class="dropdown-item text-danger py-2" onclick="deleteItem('{{ item.id }}', event)" href="{{ url_for('delete', item_id=item.id) }}">Delete <i class="bi bi-trash3"></i></button></li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingStaples">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseStaples" aria-expanded="true" aria-controls="collapseStaples">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="me-2">
                            <g clip-path="url(#clip0_12_7)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M13.9286 3.50968C15.8928 2.75868 18 4.20901 18 6.31183V7.35L6.19943 6.46496L13.9286 3.50968ZM1.30689 6.27884C1.40066 6.18863 1.5137 6.11535 1.64289 6.06595L13.2143 1.64157C16.4879 0.389915 20 2.80714 20 6.31183V9.5H20V15.795C20 18.0826 18.085 19.9042 15.8002 19.79L3.80025 19.19C1.67142 19.0836 0 17.3265 0 15.195V8.15561C0 7.28957 0.548138 6.55959 1.30689 6.27884ZM2 8.15562L18 9.35562V15.795C18 16.9388 17.0425 17.8496 15.9001 17.7925L3.90013 17.1925C2.83571 17.1393 2 16.2607 2 15.195L2 8.15562ZM8 11.5C8 12.3284 7.32843 13 6.5 13C5.67157 13 5 12.3284 5 11.5C5 10.6716 5.67157 10 6.5 10C7.32843 10 8 10.6716 8 11.5ZM14 13.5C14 13.7761 13.7761 14 13.5 14C13.2239 14 13 13.7761 13 13.5C13 13.2239 13.2239 13 13.5 13C13.7761 13 14 13.2239 14 13.5ZM16 13.5C16 14.8807 14.8807 16 13.5 16C12.1193 16 11 14.8807 11 13.5C11 12.1193 12.1193 11 13.5 11C14.8807 11 16 12.1193 16 13.5Z" />
                            </g>
                            <defs>
                                <clipPath id="clip0_12_7">
                                    <rect width="20" height="20" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>Dairy and Stock <span class="badge text-body bg-secondary bg-opacity-25 ms-2">{{ items_by_category['Staples'] | length }}</span>
                    </button>
                </h2>
                <div id="collapseStaples" class="accordion-collapse collapse" aria-labelledby="headingStaples">
                    <div class="accordion-body p-2">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                            <button class="btn btn-outline-secondary" onclick="selectAll('Staples')"><i class="bi bi-check-square me-1"></i>Select all</button>
                            <button class="btn btn-outline-secondary" onclick="selectNone('Staples')"><i class="bi bi-square me-1"></i>Select none</button>
                        </div>
                        <ul class="list-group sortable-list mt-2" data-category="Staples" id="Staples">
                            {% for item in items_by_category['Staples'] %}
                            <li class="list-group-item ps-1 d-flex align-items-center" data-id="{{ item.id }}">
                                <div class="px-2 py-1 me-1 opacity-75 dragHandle"><i class="bi bi-grip-vertical"></i></div>
                                <input class="form-check-input me-2 my-0 my-0" type="checkbox" value="{{ item.name }}" id="{{ item.id }}">
                                <label class="form-check-label flex-fill text-break" for="{{ item.id }}">{% if item.name|length > 64 %}{{ item.name[:64] }}...{% else %}{{ item.name }}{% endif %}<span class="tags-container mx-1" id="tags-{{ item.id }}"></span></label>
                                <div class="dropdown float-end mb-auto">
                                    <button class="btn btn-outline-secondary btn-sm" type="button" id="dropdownMenuButton-{{ item.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ item.id }}">
                                        <li><h6 class="dropdown-header">Tags</h6></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Fresh')" data-item-id="{{ item.id }}" data-tag="Fresh">Fresh</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Old')" data-item-id="{{ item.id }}" data-tag="Old">Old</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Frozen')" data-item-id="{{ item.id }}" data-tag="Frozen">Frozen</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Low')" data-item-id="{{ item.id }}" data-tag="Low">Low</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><button class="dropdown-item py-2" onclick="startEditItem('{{ item.id }}', event)">Edit <i class="bi bi-pencil"></i></button></li>
                                        <li><button class="dropdown-item text-danger py-2" onclick="deleteItem('{{ item.id }}', event)" href="{{ url_for('delete', item_id=item.id) }}">Delete <i class="bi bi-trash3"></i></button></li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingOils">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOils" aria-expanded="true" aria-controls="collapseOils">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="me-2">
                            <g clip-path="url(#clip0_12_9)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 5.5518V2H6.25V5.63421C6.25 7.25326 6.90432 8.80359 8.06433 9.93307L8.13307 10H2.60342L3.10933 9.39291C4.0079 8.31462 4.5 6.95542 4.5 5.5518ZM2 12V16C2 17.1046 2.89543 18 4 18H7C8.10457 18 9 17.1046 9 16V12.2819V12H2ZM10 18.6458C9.26706 19.4762 8.19469 20 7 20H4C1.79086 20 0 18.2091 0 16V11.4482C0 10.5125 0.328065 9.60632 0.927115 8.88746L1.57289 8.11254C2.17194 7.39368 2.5 6.48755 2.5 5.5518V2C2.5 0.89543 3.39543 0 4.5 0H6.25C7.35457 0 8.25 0.895431 8.25 2V5.63421C8.25 6.71358 8.68621 7.74713 9.45955 8.50011L9.79045 8.82229C9.94447 8.97226 10.0851 9.13336 10.2116 9.30374L10.9018 8.33752C10.9604 8.25543 11.0247 8.17854 11.0939 8.10724C11.0329 7.91573 11 7.71171 11 7.5V6C11 4.89543 11.8954 4 13 4H16C17.1046 4 18 4.89543 18 6V7.5C18 7.77013 17.9464 8.02776 17.8494 8.26284L17.8506 8.26436L19.1453 9.91217C19.699 10.6169 20 11.4872 20 12.3835V16C20 18.2091 18.2091 20 16 20H13C11.8053 20 10.7329 19.4762 10 18.6458ZM16 7.5H13V6H16V7.5ZM12.5292 9.5H13H16H16.2779L17.5726 11.1478C17.8495 11.5002 18 11.9353 18 12.3835V16C18 17.1046 17.1046 18 16 18H13C11.8954 18 11 17.1046 11 16V12.2819C11 11.865 11.1302 11.4586 11.3725 11.1194L12.5292 9.5Z" />
                            </g>
                            <defs>
                                <clipPath id="clip0_12_9">
                                    <rect width="20" height="20" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>Oils and Seasoning <span class="badge text-body bg-secondary bg-opacity-25 ms-2">{{ items_by_category['Oils'] | length }}</span>
                    </button>
                </h2>
                <div id="collapseOils" class="accordion-collapse collapse" aria-labelledby="headingOils">
                    <div class="accordion-body p-2">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                            <button class="btn btn-outline-secondary" onclick="selectAll('Oils')"><i class="bi bi-check-square me-1"></i>Select all</button>
                            <button class="btn btn-outline-secondary" onclick="selectNone('Oils')"><i class="bi bi-square me-1"></i>Select none</button>
                        </div>
                        <ul class="list-group sortable-list mt-2" data-category="Oils" id="Oils">
                            {% for item in items_by_category['Oils'] %}
                            <li class="list-group-item ps-1 d-flex align-items-center" data-id="{{ item.id }}">
                                <div class="px-2 py-1 me-1 opacity-75 dragHandle"><i class="bi bi-grip-vertical"></i></div>
                                <input class="form-check-input me-2 my-0" type="checkbox" value="{{ item.name }}" id="{{ item.id }}">
                                <label class="form-check-label flex-fill text-break" for="{{ item.id }}">{% if item.name|length > 64 %}{{ item.name[:64] }}...{% else %}{{ item.name }}{% endif %}<span class="tags-container mx-1" id="tags-{{ item.id }}"></span></label>
                                <div class="dropdown float-end mb-auto">
                                    <button class="btn btn-outline-secondary btn-sm" type="button" id="dropdownMenuButton-{{ item.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ item.id }}">
                                        <li><h6 class="dropdown-header">Tags</h6></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Fresh')" data-item-id="{{ item.id }}" data-tag="Fresh">Fresh</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Old')" data-item-id="{{ item.id }}" data-tag="Old">Old</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Frozen')" data-item-id="{{ item.id }}" data-tag="Frozen">Frozen</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Low')" data-item-id="{{ item.id }}" data-tag="Low">Low</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><button class="dropdown-item py-2" onclick="startEditItem('{{ item.id }}', event)">Edit <i class="bi bi-pencil"></i></button></li>
                                        <li><button class="dropdown-item text-danger py-2" onclick="deleteItem('{{ item.id }}', event)" href="{{ url_for('delete', item_id=item.id) }}">Delete <i class="bi bi-trash3"></i></button></li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingPantry">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePantry" aria-expanded="true" aria-controls="collapsePantry">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="me-2">
                            <g clip-path="url(#clip0_12_11)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M6 15C7.10457 15 8 14.1046 8 13C8 11.8954 7.10457 11 6 11C4.89543 11 4 11.8954 4 13C4 14.1046 4.89543 15 6 15Z" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M14 13C15.1046 13 16 12.1046 16 11C16 9.89543 15.1046 9 14 9C12.8954 9 12 9.89543 12 11C12 12.1046 12.8954 13 14 13Z" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M11.344 2.92716C11.8278 2.68779 12.4056 2.5 13 2.5C13.5773 2.5 14.415 2.75665 15.3143 3.16177C15.3185 3.16365 15.3227 3.16553 15.3268 3.16742C14.0038 3.352 12.6495 3.27331 11.344 2.92716ZM8.92529 2.16668C9.6105 1.54096 11.1619 0.5 13 0.5C14.0227 0.5 15.1851 0.910013 16.1357 1.33823C16.871 1.66945 17.5597 2.04897 18.0861 2.36994C18.0939 2.36639 18.1018 2.36282 18.1097 2.35924C18.946 1.97911 19.8788 2.65145 19.7826 3.56503L19.3398 7.77226C19.1139 9.91783 19.1202 12.0815 19.3584 14.2257L19.7532 17.7791C19.8849 18.9639 18.9575 20 17.7655 20H9.05139L9.04853 20H9H3H1C0.447715 20 0 19.5523 0 19C0 18.4477 0.447715 18 1 18V8C0.447715 8 0 7.55228 0 7C0 6.44772 0.447715 6 1 6H3H7.06301C7.02188 5.84019 7 5.67265 7 5.50001V3.82125C7 2.77654 7.93633 2.01271 8.92529 2.16668ZM11.0039 18H17.7655L17.3706 14.4466C17.1165 12.1594 17.1098 9.8515 17.3508 7.56289L17.6545 4.67716C15.2106 5.46773 12.5653 5.46329 10.1059 4.6435L9 4.27486V6H11C11.5523 6 12 6.44772 12 7C12 7.55228 11.5523 8 11 8V18L11.0039 18ZM9 8V18H3V8H9Z" />
                            </g>
                            <defs>
                                <clipPath id="clip0_12_11">
                                    <rect width="20" height="20" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>Canned and Bagged <span class="badge text-body bg-secondary bg-opacity-25 ms-2">{{ items_by_category['Pantry'] | length }}</span>
                    </button>
                </h2>
                <div id="collapsePantry" class="accordion-collapse collapse" aria-labelledby="headingPantry">
                    <div class="accordion-body p-2">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                            <button class="btn btn-outline-secondary" onclick="selectAll('Pantry')"><i class="bi bi-check-square me-1"></i>Select all</button>
                            <button class="btn btn-outline-secondary" onclick="selectNone('Pantry')"><i class="bi bi-square me-1"></i>Select none</button>
                        </div>
                        <ul class="list-group sortable-list mt-2" data-category="Pantry" id="Pantry">
                            {% for item in items_by_category['Pantry'] %}
                            <li class="list-group-item ps-1 d-flex align-items-center" data-id="{{ item.id }}">
                                <div class="px-2 py-1 me-1 opacity-75 dragHandle"><i class="bi bi-grip-vertical"></i></div>
                                <input class="form-check-input me-2 my-0" type="checkbox" value="{{ item.name }}" id="{{ item.id }}">
                                <label class="form-check-label flex-fill text-break" for="{{ item.id }}">{% if item.name|length > 64 %}{{ item.name[:64] }}...{% else %}{{ item.name }}{% endif %}<span class="tags-container mx-1" id="tags-{{ item.id }}"></span></label>
                                <div class="dropdown float-end mb-auto">
                                    <button class="btn btn-outline-secondary btn-sm" type="button" id="dropdownMenuButton-{{ item.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ item.id }}">
                                        <li><h6 class="dropdown-header">Tags</h6></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Fresh')" data-item-id="{{ item.id }}" data-tag="Fresh">Fresh</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Old')" data-item-id="{{ item.id }}" data-tag="Old">Old</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Frozen')" data-item-id="{{ item.id }}" data-tag="Frozen">Frozen</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Low')" data-item-id="{{ item.id }}" data-tag="Low">Low</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><button class="dropdown-item py-2" onclick="startEditItem('{{ item.id }}', event)">Edit <i class="bi bi-pencil"></i></button></li>
                                        <li><button class="dropdown-item text-danger py-2" onclick="deleteItem('{{ item.id }}', event)" href="{{ url_for('delete', item_id=item.id) }}">Delete <i class="bi bi-trash3"></i></button></li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingVegetables">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseVegetables" aria-expanded="true" aria-controls="collapseVegetables">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="me-2">
                            <g clip-path="url(#clip0_12_13)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M3.01793 8.25691L4.18849 7.59457L4.01661 6.26065C4.00572 6.17619 4 6.08925 4 6C4 4.89543 4.89543 4 6 4C6.08925 4 6.17619 4.00572 6.26065 4.01661L7.59457 4.18849L8.25691 3.01793C8.60325 2.40585 9.25552 2 10 2C10.7445 2 11.3967 2.40585 11.7431 3.01793L12.4054 4.18849L13.7394 4.01661C13.8238 4.00572 13.9107 4 14 4C15.1046 4 16 4.89543 16 6C16 6.08926 15.9943 6.17619 15.9834 6.26064L15.8115 7.59457L16.9821 8.25692C17.5942 8.60326 18 9.25552 18 10C18 11.0698 17.1324 12.2848 15.1272 13.5457C14.0222 14.2405 12.7736 14.8192 11.6147 15.2842L14.8516 10.0241C15.1411 9.55373 14.9944 8.93778 14.5241 8.64833C14.0537 8.35888 13.4378 8.50554 13.1483 8.9759L11 12.4669L11 5C11 4.44772 10.5523 4 10 4C9.44771 4 9 4.44772 9 5L9 12.4669L6.85167 8.9759C6.56222 8.50554 5.94627 8.35888 5.47592 8.64833C5.00556 8.93779 4.8589 9.55373 5.14835 10.0241L8.38533 15.2842C7.22639 14.8192 5.97778 14.2405 4.87279 13.5457C2.86763 12.2848 2 11.0698 2 10C2 9.25552 2.40585 8.60325 3.01793 8.25691ZM9 17.6551C5.58224 16.4325 0 13.9466 0 10C0 8.50585 0.819225 7.20304 2.03301 6.51624C2.01123 6.34724 2 6.17493 2 6C2 3.79086 3.79086 2 6 2C6.17493 2 6.34724 2.01123 6.51624 2.03301C7.20304 0.819225 8.50585 0 10 0C11.4941 0 12.797 0.819225 13.4838 2.03301C13.6528 2.01123 13.8251 2 14 2C16.2091 2 18 3.79086 18 6C18 6.17493 17.9888 6.34724 17.967 6.51625C19.1808 7.20305 20 8.50585 20 10C20 13.9466 14.4178 16.4325 11 17.6551V19C11 19.5523 10.5523 20 10 20C9.44772 20 9 19.5523 9 19V17.6551Z" />
                            </g>
                            <defs>
                                <clipPath id="clip0_12_13">
                                    <rect width="20" height="20" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>Vegetables <span class="badge text-body bg-secondary bg-opacity-25 ms-2">{{ items_by_category['Vegetables'] | length }}</span>
                    </button>
                </h2>
                <div id="collapseVegetables" class="accordion-collapse collapse" aria-labelledby="headingVegetables">
                    <div class="accordion-body p-2">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                            <button class="btn btn-outline-secondary" onclick="selectAll('Vegetables')"><i class="bi bi-check-square me-1"></i>Select all</button>
                            <button class="btn btn-outline-secondary" onclick="selectNone('Vegetables')"><i class="bi bi-square me-1"></i>Select none</button>
                        </div>
                        <ul class="list-group sortable-list mt-2" data-category="Vegetables" id="Vegetables">
                            {% for item in items_by_category['Vegetables'] %}
                            <li class="list-group-item ps-1 d-flex align-items-center" data-id="{{ item.id }}">
                                <div class="px-2 py-1 me-1 opacity-75 dragHandle"><i class="bi bi-grip-vertical"></i></div>
                                <input class="form-check-input me-2 my-0" type="checkbox" value="{{ item.name }}" id="{{ item.id }}">
                                <label class="form-check-label flex-fill text-break" for="{{ item.id }}">{% if item.name|length > 64 %}{{ item.name[:64] }}...{% else %}{{ item.name }}{% endif %}<span class="tags-container mx-1" id="tags-{{ item.id }}"></span></label>
                                <div class="dropdown float-end mb-auto">
                                    <button class="btn btn-outline-secondary btn-sm" type="button" id="dropdownMenuButton-{{ item.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ item.id }}">
                                        <li><h6 class="dropdown-header">Tags</h6></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Fresh')" data-item-id="{{ item.id }}" data-tag="Fresh">Fresh</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Old')" data-item-id="{{ item.id }}" data-tag="Old">Old</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Frozen')" data-item-id="{{ item.id }}" data-tag="Frozen">Frozen</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Low')" data-item-id="{{ item.id }}" data-tag="Low">Low</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><button class="dropdown-item py-2" onclick="startEditItem('{{ item.id }}', event)">Edit <i class="bi bi-pencil"></i></button></li>
                                        <li><button class="dropdown-item text-danger py-2" onclick="deleteItem('{{ item.id }}', event)" href="{{ url_for('delete', item_id=item.id) }}">Delete <i class="bi bi-trash3"></i></button></li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingFruits">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFruits" aria-expanded="true" aria-controls="collapseFruits">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="me-2">
                            <g clip-path="url(#clip0_12_15)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M16.3727 14.6039L16.7645 13.6276C17.7503 11.171 17.1307 7.82576 14.6525 5.34754C12.1291 2.82414 8.71174 2.22967 6.24389 3.28891L5.2915 3.69768L4.40836 3.15529C4.05744 2.93976 3.59139 2.98708 3.28926 3.28921C2.98714 3.59133 2.93981 4.05738 3.15533 4.4083L3.69771 5.29145L3.28892 6.24383C2.22965 8.71169 2.8241 12.1291 5.34752 14.6525C7.82576 17.1307 11.171 17.7503 13.6276 16.7645L14.6039 16.3727L15.4799 16.9551C15.8924 17.2295 16.4563 17.182 16.8192 16.8192C17.182 16.4563 17.2295 15.8924 16.9551 15.4799L16.3727 14.6039ZM18.6206 14.3725C19.9396 11.0856 19.0418 6.90848 16.0667 3.93332C13.0392 0.905873 8.76714 0.0294552 5.45505 1.45104C4.33359 0.762278 2.84645 0.903595 1.87505 1.875C0.903655 2.84639 0.762331 4.33351 1.45107 5.45497C0.0294223 8.76707 0.905828 13.0392 3.93331 16.0667C6.90847 19.0419 11.0857 19.9396 14.3725 18.6206C15.5626 19.4119 17.1839 19.2829 18.2334 18.2334C19.2829 17.1839 19.4119 15.5626 18.6206 14.3725Z" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M7.51358 4.8356C7.60437 4.29083 8.1196 3.92281 8.66437 4.01361C9.23131 4.1081 10.1087 4.32802 10.9659 4.69208C11.791 5.04251 12.7658 5.59602 13.332 6.4453C13.6384 6.90483 13.5142 7.5257 13.0547 7.83205C12.5951 8.13841 11.9743 8.01423 11.6679 7.5547C11.4341 7.20399 10.909 6.84083 10.184 6.53292C9.4912 6.23865 8.76863 6.05857 8.33557 5.9864C7.7908 5.8956 7.42278 5.38037 7.51358 4.8356Z" />
                            </g>
                            <defs>
                                <clipPath id="clip0_12_15">
                                    <rect width="20" height="20" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>Fruits <span class="badge text-body bg-secondary bg-opacity-25 ms-2">{{ items_by_category['Fruits'] | length }}</span>
                    </button>
                </h2>
                <div id="collapseFruits" class="accordion-collapse collapse" aria-labelledby="headingFruits">
                    <div class="accordion-body p-2">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                            <button class="btn btn-outline-secondary" onclick="selectAll('Fruits')"><i class="bi bi-check-square me-1"></i>Select all</button>
                            <button class="btn btn-outline-secondary" onclick="selectNone('Fruits')"><i class="bi bi-square me-1"></i>Select none</button>
                        </div>
                        <ul class="list-group sortable-list mt-2" data-category="Fruits" id="Fruits">
                            {% for item in items_by_category['Fruits'] %}
                            <li class="list-group-item ps-1 d-flex align-items-center" data-id="{{ item.id }}">
                                <div class="px-2 py-1 me-1 opacity-75 dragHandle"><i class="bi bi-grip-vertical"></i></div>
                                <input class="form-check-input me-2 my-0" type="checkbox" value="{{ item.name }}" id="{{ item.id }}">
                                <label class="form-check-label flex-fill text-break" for="{{ item.id }}">{% if item.name|length > 64 %}{{ item.name[:64] }}...{% else %}{{ item.name }}{% endif %}<span class="tags-container mx-1" id="tags-{{ item.id }}"></span></label>
                                <div class="dropdown float-end mb-auto">
                                    <button class="btn btn-outline-secondary btn-sm" type="button" id="dropdownMenuButton-{{ item.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ item.id }}">
                                        <li><h6 class="dropdown-header">Tags</h6></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Fresh')" data-item-id="{{ item.id }}" data-tag="Fresh">Fresh</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Old')" data-item-id="{{ item.id }}" data-tag="Old">Old</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Frozen')" data-item-id="{{ item.id }}" data-tag="Frozen">Frozen</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Low')" data-item-id="{{ item.id }}" data-tag="Low">Low</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><button class="dropdown-item py-2" onclick="startEditItem('{{ item.id }}', event)">Edit <i class="bi bi-pencil"></i></button></li>
                                        <li><button class="dropdown-item text-danger py-2" onclick="deleteItem('{{ item.id }}', event)" href="{{ url_for('delete', item_id=item.id) }}">Delete <i class="bi bi-trash3"></i></button></li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingMeats">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseMeats" aria-expanded="true" aria-controls="collapseMeats">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="me-2">
                            <g clip-path="url(#clip0_12_17)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M5.15718 10.4339L9.10618 12.8887C10.1902 13.5626 11.5957 13.4008 12.4983 12.4982C13.4008 11.5956 13.5626 10.1902 12.8887 9.10613L10.434 5.15713C10.2065 6.3162 9.56424 7.52767 8.54598 8.54594C7.52771 9.5642 6.31625 10.2065 5.15718 10.4339ZM2.49824 2.4982C-0.224204 5.22064 0.299428 9.76916 3.56927 11.8018L8.05031 14.5873C9.63356 15.5715 11.6135 15.5242 13.1303 14.5445L13.9672 15.3814C13.9487 15.3987 13.9305 15.4163 13.9125 15.4343C13.072 16.2748 13.072 17.6376 13.9125 18.4781C14.753 19.3186 16.1157 19.3186 16.9563 18.4781C17.2335 18.2009 17.4193 17.8669 17.5136 17.5135C17.8669 17.4192 18.2009 17.2334 18.4781 16.9562C19.3186 16.1157 19.3186 14.7529 18.4781 13.9124C17.6376 13.0719 16.2748 13.0719 15.4343 13.9124C15.4163 13.9304 15.3987 13.9487 15.3814 13.9672L14.5445 13.1303C15.5243 11.6135 15.5715 9.63354 14.5873 8.05026L11.8018 3.56923C9.7692 0.29938 5.22068 -0.224248 2.49824 2.4982ZM7.13176 7.13172C6.32425 7.93923 5.41059 8.37278 4.65562 8.49198C3.89827 8.61156 3.45979 8.4095 3.24267 8.19238C2.97875 7.92845 2.70267 7.3203 2.76781 6.4168C2.83033 5.5497 3.20334 4.6251 3.91422 3.91421C4.62511 3.20332 5.54973 2.83031 6.41683 2.76779C7.32034 2.70264 7.9285 2.97871 8.19242 3.24263C8.40954 3.45975 8.6116 3.89823 8.49202 4.65558C8.37282 5.41055 7.93927 6.32421 7.13176 7.13172Z" />
                                <path d="M6.42466 6.42463C5.83887 7.01041 5.04742 7.1687 4.65689 6.77818C4.26637 6.38766 4.42466 5.5962 5.01045 5.01041C5.59623 4.42463 6.38769 4.26634 6.77821 4.65686C7.16874 5.04738 7.01045 5.83884 6.42466 6.42463Z" />
                            </g>
                            <defs>
                                <clipPath id="clip0_12_17">
                                    <rect width="20" height="20" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>Meats <span class="badge text-body bg-secondary bg-opacity-25 ms-2">{{ items_by_category['Meats'] | length }}</span>
                    </button>
                </h2>
                <div id="collapseMeats" class="accordion-collapse collapse" aria-labelledby="headingMeats">
                    <div class="accordion-body p-2">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                            <button class="btn btn-outline-secondary" onclick="selectAll('Meats')"><i class="bi bi-check-square me-1"></i>Select all</button>
                            <button class="btn btn-outline-secondary" onclick="selectNone('Meats')"><i class="bi bi-square me-1"></i>Select none</button>
                        </div>
                        <ul class="list-group sortable-list mt-2" data-category="Meats" id="Meats">
                            {% for item in items_by_category['Meats'] %}
                            <li class="list-group-item ps-1 d-flex align-items-center" data-id="{{ item.id }}">
                                <div class="px-2 py-1 me-1 opacity-75 dragHandle"><i class="bi bi-grip-vertical"></i></div>
                                <input class="form-check-input me-2 my-0" type="checkbox" value="{{ item.name }}" id="{{ item.id }}">
                                <label class="form-check-label flex-fill text-break" for="{{ item.id }}">{% if item.name|length > 64 %}{{ item.name[:64] }}...{% else %}{{ item.name }}{% endif %}<span class="tags-container mx-1" id="tags-{{ item.id }}"></span></label>
                                <div class="dropdown float-end mb-auto">
                                    <button class="btn btn-outline-secondary btn-sm" type="button" id="dropdownMenuButton-{{ item.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ item.id }}">
                                        <li><h6 class="dropdown-header">Tags</h6></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Fresh')" data-item-id="{{ item.id }}" data-tag="Fresh">Fresh</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Old')" data-item-id="{{ item.id }}" data-tag="Old">Old</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Frozen')" data-item-id="{{ item.id }}" data-tag="Frozen">Frozen</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Low')" data-item-id="{{ item.id }}" data-tag="Low">Low</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><button class="dropdown-item py-2" onclick="startEditItem('{{ item.id }}', event)">Edit <i class="bi bi-pencil"></i></button></li>
                                        <li><button class="dropdown-item text-danger py-2" onclick="deleteItem('{{ item.id }}', event)" href="{{ url_for('delete', item_id=item.id) }}">Delete <i class="bi bi-trash3"></i></button></li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingBaking">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBaking" aria-expanded="true" aria-controls="collapseBaking">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="me-2">
                            <g clip-path="url(#clip0_12_19)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M9 8.00127V18H4V8.00127L3.20116 7.40123C2.46798 6.85052 2 5.9802 2 5C2 3.34315 3.34315 2 5 2H8C9.65685 2 11 3.34315 11 5C11 5.9802 10.532 6.85052 9.79884 7.40123L9 8.00127ZM12.0004 2C12.6281 2.83566 13 3.87439 13 5C13 6.63582 12.2144 8.08816 11 9.00037V18H16V8.00127L16.7988 7.40123C17.532 6.85052 18 5.9802 18 5C18 3.34315 16.6569 2 15 2H12.0004ZM5 0C2.23858 0 0 2.23858 0 5C0 6.63582 0.785553 8.08816 2 9.00037V18C2 19.1046 2.89543 20 4 20H9H16C17.1046 20 18 19.1046 18 18V9.00037C19.2144 8.08816 20 6.63582 20 5C20 2.23858 17.7614 0 15 0H8H5Z" />
                            </g>
                            <defs>
                                <clipPath id="clip0_12_19">
                                    <rect width="20" height="20" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>Flours and Baking <span class="badge text-body bg-secondary bg-opacity-25 ms-2">{{ items_by_category['Baking'] | length }}</span>
                    </button>
                </h2>
                <div id="collapseBaking" class="accordion-collapse collapse" aria-labelledby="headingBaking">
                    <div class="accordion-body p-2">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                            <button class="btn btn-outline-secondary" onclick="selectAll('Baking')"><i class="bi bi-check-square me-1"></i>Select all</button>
                            <button class="btn btn-outline-secondary" onclick="selectNone('Baking')"><i class="bi bi-square me-1"></i>Select none</button>
                        </div>
                        <ul class="list-group sortable-list mt-2" data-category="Baking" id="Baking">
                            {% for item in items_by_category['Baking'] %}
                            <li class="list-group-item ps-1 d-flex align-items-center" data-id="{{ item.id }}">
                                <div class="px-2 py-1 me-1 opacity-75 dragHandle"><i class="bi bi-grip-vertical"></i></div>
                                <input class="form-check-input me-2 my-0" type="checkbox" value="{{ item.name }}" id="{{ item.id }}">
                                <label class="form-check-label flex-fill text-break" for="{{ item.id }}">{% if item.name|length > 64 %}{{ item.name[:64] }}...{% else %}{{ item.name }}{% endif %}<span class="tags-container mx-1" id="tags-{{ item.id }}"></span></label>
                                <div class="dropdown float-end mb-auto">
                                    <button class="btn btn-outline-secondary btn-sm" type="button" id="dropdownMenuButton-{{ item.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ item.id }}">
                                        <li><h6 class="dropdown-header">Tags</h6></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Fresh')" data-item-id="{{ item.id }}" data-tag="Fresh">Fresh</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Old')" data-item-id="{{ item.id }}" data-tag="Old">Old</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Frozen')" data-item-id="{{ item.id }}" data-tag="Frozen">Frozen</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Low')" data-item-id="{{ item.id }}" data-tag="Low">Low</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><button class="dropdown-item py-2" onclick="startEditItem('{{ item.id }}', event)">Edit <i class="bi bi-pencil"></i></button></li>
                                        <li><button class="dropdown-item text-danger py-2" onclick="deleteItem('{{ item.id }}', event)" href="{{ url_for('delete', item_id=item.id) }}">Delete <i class="bi bi-trash3"></i></button></li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>

            <div class="accordion-item">
                <h2 class="accordion-header" id="headingAlcohol">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseAlcohol" aria-expanded="true" aria-controls="collapseAlcohol">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none" class="me-2">
                            <g clip-path="url(#clip0_12_21)">
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M13 7L15 9.66667L17 7H13ZM11 5H19C19.824 5 20.2944 5.94076 19.8 6.6L16 11.6666V18H17C17.5523 18 18 18.4477 18 19C18 19.5523 17.5523 20 17 20H13C12.4477 20 12 19.5523 12 19C12 18.4477 12.4477 18 13 18H14V11.6667L10.2 6.6C9.70556 5.94076 10.1759 5 11 5Z" />
                                <path fill-rule="evenodd" clip-rule="evenodd" d="M4.5 6.63882L3.25043 7.14463C2.51379 7.44282 2 8.16381 2 9H5H8C8 8.16381 7.48621 7.44282 6.74957 7.14463L5.5 6.63882V2L4.5 2V6.63882ZM3 11H2V16C2 17.1046 2.89543 18 4 18H6C7.10457 18 8 17.1046 8 16V11H7C7 12.1046 6.10457 13 5 13C3.89543 13 3 12.1046 3 11ZM2.5 2C2.5 0.89543 3.39543 0 4.5 0H5.5C6.60457 0 7.5 0.895431 7.5 2V5.29076C8.96591 5.88415 10 7.32131 10 9V16C10 18.2091 8.20914 20 6 20H4C1.79086 20 0 18.2091 0 16V9C0 7.32131 1.03408 5.88415 2.5 5.29076V2Z" />
                            </g>
                            <defs>
                                <clipPath id="clip0_12_21">
                                    <rect width="20" height="20" fill="white" />
                                </clipPath>
                            </defs>
                        </svg>Alcohol <span class="badge text-body bg-secondary bg-opacity-25 ms-2">{{ items_by_category['Alcohol'] | length }}</span>
                    </button>
                </h2>
                <div id="collapseAlcohol" class="accordion-collapse collapse" aria-labelledby="headingAlcohol">
                    <div class="accordion-body p-2">
                        <div class="btn-group btn-group-sm" role="group" aria-label="Small button group">
                            <button class="btn btn-outline-secondary" onclick="selectAll('Alcohol')"><i class="bi bi-check-square me-1"></i>Select all</button>
                            <button class="btn btn-outline-secondary" onclick="selectNone('Alcohol')"><i class="bi bi-square me-1"></i>Select none</button>
                        </div>
                        <ul class="list-group sortable-list mt-2" data-category="Alcohol" id="Alcohol">
                            {% for item in items_by_category['Alcohol'] %}
                            <li class="list-group-item ps-1 d-flex align-items-center" data-id="{{ item.id }}">
                                <div class="px-2 py-1 me-1 opacity-75 dragHandle"><i class="bi bi-grip-vertical"></i></div>
                                <input class="form-check-input me-2 my-0" type="checkbox" value="{{ item.name }}" id="{{ item.id }}">
                                <label class="form-check-label flex-fill text-break text-break" for="{{ item.id }}">{% if item.name|length > 64 %}{{ item.name[:64] }}...{% else %}{{ item.name }}{% endif %}<span class="tags-container mx-1" id="tags-{{ item.id }}"></span></label>
                                <div class="dropdown float-end mb-auto">
                                    <button class="btn btn-outline-secondary btn-sm" type="button" id="dropdownMenuButton-{{ item.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots-vertical"></i>
                                    </button>
                                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton-{{ item.id }}">
                                        <li><h6 class="dropdown-header">Tags</h6></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Fresh')" data-item-id="{{ item.id }}" data-tag="Fresh">Fresh</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Old')" data-item-id="{{ item.id }}" data-tag="Old">Old</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Frozen')" data-item-id="{{ item.id }}" data-tag="Frozen">Frozen</a></li>
                                        <li><a class="dropdown-item toggle-tag py-2" href="#" onclick="toggleTag(event, '{{ item.id }}', 'Low')" data-item-id="{{ item.id }}" data-tag="Low">Low</a></li>
                                        <li><hr class="dropdown-divider"></li>
                                        <li><button class="dropdown-item py-2" onclick="startEditItem('{{ item.id }}', event)">Edit <i class="bi bi-pencil"></i></button></li>
                                        <li><button class="dropdown-item text-danger py-2" onclick="deleteItem('{{ item.id }}', event)" href="{{ url_for('delete', item_id=item.id) }}">Delete <i class="bi bi-trash3"></i></button></li>
                                    </ul>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container mt-4 py-4 bg-secondary-subtle rounded">
            <div class="row m-auto">
                <h4>Make something</h4>
                <p>Select items above (or select nothing to use full list). Then, select a prompt type.</p>
            </div>
            <form action="{{ url_for('ask_gpt4') }}" method="POST" class="mx-3 mt-1" id="askGptForm">
                <!-- Prompt selection -->
                <div name="selected_prompt" class="mb-3 mx-auto row gap-2" id="promptSelect">
                    {% for key, prompt in prompts.items() %}
                    <input type="radio" class="btn-check" name="options" value="{{ key }}" id="option-{{ key }}" autocomplete="off" style="display: none;" {{ 'checked' if loop.first }}>
                    <label value="{{ key }}" class="col-lg btn btn-outline-secondary" for="option-{{ key }}">{{ key }}</label>
                    {% endfor %}
                </div>
                <!-- Advanced settings -->
                <a class="mb-2 btn btn-link align-items-center col-12" onclick="toggleAdvancedSettings()"><i class="bi bi-gear me-2"></i>Advanced settings</a>
                <div class="row g-3 mb-3" style="display: none" id="advancedSettings">
                    <div class="col-md-6">
                        <select class="form-select" id="regionSelect" name="region">
                            <option selected>Select a region</option>
                            <option value="North America">North America</option>
                            <option value="Latin America">Latin America</option>
                            <option value="Western Europe">Western Europe</option>
                            <option value="Eastern Europe">Eastern Europe</option>
                            <option value="Middle East">Middle East</option>
                            <option value="Africa">Africa</option>
                            <option value="South Asia">South Asia</option>
                            <option value="Southeast Asia">Southeast Asia</option>
                            <option value="East Asia">East Asia</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <select class="form-select" id="modifierSelect" name="modifier">
                            <option selected>Select a modifier</option>
                            <option value="simple">Simple</option>
                            <option value="quick and easy">Quick and Easy</option>
                            <option value="meal prep">Meal prep</option>
                            <option value="inventive">Inventive</option>
                            <option value="complex">Complex</option>
                            <option value="haute cuisine">Haute Cuisine</option>
                            <option value="fusion">Fusion</option>
                            <option value="spicy">Spicy</option>
                            <option value="indulgent">Indulgent</option>
                        </select>
                    </div>
                    <div class="col-md-9">
                        <input type="text" class="form-control" id="specifications" name="specifications" placeholder="Specific dish or instructions" ">
                    </div>
                    <div class="col d-grid">
                        <button type="button" class="btn btn-secondary" id="randomizeBtn" onclick="randomizeSelections()"><i class="bi bi-dice-5-fill me-2"></i>Randomize</button>
                    </div>
                </div>
                <input type="hidden" name="selected_items" id="selectedItems">
                <div class="d-flex justify-content-center py-3">
                    <button id="askGptButton" type="submit" class="btn btn-primary btn-lg col-md-4 col-12">
                        <div id="buttonLoadingIndicator" class="spinner-border spinner-border-sm" role="status" style="display: none"></div>
                        <i id="buttonStars" class="bi bi-stars"></i> Ask ChefGPT
                    </button>
                </div>
            </form>

            <div id="gptLoader" class="mt-3 bg-secondary-subtle col-12" style="display: none;">
                <div class="gpt-response-container d-grid justify-content-center">
                    <div id="loadingIndicator" class="d-grid justify-content-center">
                            <svg-animate trigger="loop" role="status">
                                <svg viewBox="0 0 140 130" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:anim="http://www.w3.org/2000/anim" anim="" anim:transform-origin="50% 50%" anim:duration="7" anim:ease="ease-in-out">
                                    <g id="chefGPT">
                                        <g id="karrot" anim:opacity="0[0.1:0.3:1:ease-in-out][0.3:0.6:1:ease-in-out][0.6:1.1:0:ease-in-out]" anim:y="0[0.3:0.6:40:ease-in-out][0.6:1.1:50:ease-in-out]" anim:rotation="0[0.2:0.5:38:ease-in-out]">
                                            <path id="Vector 3" d="M36.8214 13.757L39.1045 14.7058C40.1912 15.1574 41.351 14.2388 41.1603 13.0776L40.7597 10.6378C40.5743 9.50918 39.2448 8.99488 38.3482 9.70499L36.4657 11.196C35.5691 11.9061 35.7652 13.3181 36.8214 13.757Z" fill="#3B996D"></path>
                                            <path id="Vector 2" d="M48.6276 7.30396L31.7742 20.6522C31.2717 21.0502 31.2681 21.8115 31.7668 22.2141L69.8099 52.9335C70.6395 53.6034 71.8015 52.6831 71.3394 51.7221L50.1497 7.65451C49.8719 7.07686 49.13 6.90599 48.6276 7.30396Z" fill="#A0AFD2"></path>
                                        </g>
                                        <rect id="salt04" x="61.182" y="1" width="4.5" height="4.5" transform="rotate(45 61.182 1)" fill="#A0AFD2" anim:opacity="0[4.2:4.4:1:ease-in-out]" anim:y="-40[4.3:4.7:40:ease-in-out]"></rect>
                                        <rect id="salt03" x="67.182" y="1" width="2.63604" height="2.63604" transform="rotate(45 67.182 1)" fill="#A0AFD2" anim:opacity="0[4:4.2:1:ease-in-out]" anim:y="-40[4.1:4.5:40:ease-in-out]"></rect>
                                        <rect id="salt02" x="68.682" y="1" width="2.63604" height="2.63604" transform="rotate(45 68.682 1)" fill="#A0AFD2" anim:opacity="0[3.8:4:1:ease-in-out]" anim:y="-40[3.9:4.3:40:ease-in-out]"></rect>
                                        <rect id="salt01" x="58.182" y="1" width="4.5" height="4.5" transform="rotate(45 58.182 1)" fill="#A0AFD2" anim:opacity="0[3.6:3.8:1:ease-in-out]" anim:y="-40[3.7:4.1:40:ease-in-out]"></rect>
                                        <g id="tomato" anim:opacity="0[0.7:0.9:1:ease-in-out][0.9:1.4:1:ease-in-out][1.4:1.8:0:ease-in-out]" anim:y="0[0.9:1.3:50:ease-in-out][1.3:1.6:60:ease-in-out]" anim:rotation="0[0.9:1.3:-90:ease-in-out][1.3:1.6:-120:ease-in-out]">
                                            <path id="Ellipse 20" d="M88.4307 26.6227C85.5793 34.8405 77.0976 37.7738 68.8798 34.9224C60.6619 32.071 55.8198 24.5147 58.6712 16.2969C61.5226 8.07901 70.0043 5.14575 78.2222 7.99714C86.44 10.8485 91.2821 18.4048 88.4307 26.6227Z" fill="#A0AFD2"></path>
                                            <path id="Vector 4" d="M76.1019 6.4448L76.5278 8.8803C76.7305 10.0395 78.1282 10.5245 79.0053 9.73995L80.8482 8.09167C81.7007 7.32919 81.4205 5.93142 80.3399 5.5565L78.0712 4.7693C76.9906 4.39438 75.9049 5.31817 76.1019 6.4448Z" fill="#3B996D"></path>
                                        </g>
                                        <path id="Subtract" fill-rule="evenodd" clip-rule="evenodd" d="M74.9123 49.9502C72.0883 51.8739 68.6741 53 65 53C61.3259 53 57.9117 51.8739 55.0877 49.9502C51.9044 54.5114 46.6153 57.5 40.625 57.5C40.2471 57.5 39.872 57.4881 39.5 57.4647V63.875H90.5L90.5 57.4647C90.128 57.4881 89.7529 57.5 89.375 57.5C83.3847 57.5 78.0956 54.5114 74.9123 49.9502ZM90.5 66.125H39.5V71.375H90.5L90.5 66.125ZM40.625 55.25C40.2466 55.25 39.8715 55.2363 39.5 55.2095C32.5761 54.7087 26.923 49.623 25.5624 42.9736C25.3576 41.9727 25.25 40.9364 25.25 39.875C25.25 35.6293 26.9709 31.7856 29.7532 29.0032C30.6431 28.1134 31.6415 27.3321 32.7269 26.681C34.8232 25.4234 37.244 24.6513 39.8338 24.52C40.0959 24.5067 40.3596 24.5 40.625 24.5C43.8731 24.5 46.886 25.5072 49.3683 27.2263C49.9218 27.6097 50.449 28.0285 50.9465 28.4794C51.0176 28.5438 51.0881 28.6089 51.1579 28.6746C51.4945 27.9805 51.8818 27.3155 52.315 26.6844C55.0859 22.6477 59.7338 20 65 20C70.2662 20 74.9141 22.6477 77.685 26.6844C78.0911 27.276 78.4569 27.8975 78.7784 28.5448C78.7998 28.5879 78.821 28.6312 78.8421 28.6746C79.4009 28.1488 79.9991 27.6645 80.6317 27.2263C82.9589 25.6147 85.7524 24.6287 88.7688 24.5117C88.9699 24.5039 89.172 24.5 89.375 24.5C97.8664 24.5 104.75 31.3836 104.75 39.875C104.75 47.8357 98.6999 54.3833 90.947 55.1706C90.7986 55.1857 90.6496 55.1987 90.5 55.2095C90.1285 55.2363 89.7533 55.25 89.375 55.25C84.1088 55.25 79.4609 52.6023 76.69 48.5656C76.2568 47.9345 75.8695 47.2695 75.5329 46.5754C74.9741 47.1011 74.3759 47.5855 73.7433 48.0237C71.261 49.7428 68.2481 50.75 65 50.75C61.7519 50.75 58.739 49.7428 56.2567 48.0237C55.6241 47.5855 55.0259 47.1011 54.4671 46.5754C54.1305 47.2695 53.7432 47.9345 53.31 48.5656C50.5391 52.6023 45.8912 55.25 40.625 55.25Z" fill="#4168C4" anim:x="0[0:0.2:48:ease-in-out][4.9:5.1:0:ease-in-out]" anim:y="0[5.2:5.5:4:ease-in-out][5.5:5.8:0:ease-in-out][5.8:6.1:-8:ease-in-out][6.1:6.3:0:ease-in-out]" anim:rotation="0[0:0.2:90:ease-in-out][4.9:5.1:0:ease-in-out]"></path>
                                        <g id="oilstreaming" anim:opacity="0[2.2:2.5:1:ease-in-out]">
                                            <mask id="mask0_1_16" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="57" y="29" width="6" height="43">
                                                <rect id="mask" x="57" y="29" width="6" height="43" rx="3" fill="#D9D9D9"></rect>
                                            </mask>
                                            <g mask="url(#mask0_1_16)">
                                                <path id="oilstreaming_2" d="M58 -53C58 -54.1046 58.8954 -55 60 -55V-55C61.1046 -55 62 -54.1046 62 -53V33C62 34.1046 61.1046 35 60 35V35C58.8954 35 58 34.1046 58 33V-53Z" fill="#3B996D" anim:y="0[2.3:4.2:140:ease-in-out]"></path>
                                            </g>
                                        </g>
                                        <path id="oilpool" d="M20.5 29L57.5 29L57 34L55.8127 32.8127C55.3027 32.3027 54.5777 32.0704 53.8663 32.189V32.189C52.7893 32.3684 52 33.3002 52 34.392V37H20.5V29Z" fill="#3B996D" anim:opacity="0[2.1:2.3:1:ease-in-out][3:3.6:0:ease-in-out]"></path>
                                        <g id="oil" anim:opacity="0[1.4:1.7:1:ease-in-out][3:3.6:0:ease-in-out]" anim:rotation="0[1.9:2.1:90:ease-in-out]">
                                            <path id="Rectangle 10" d="M31.3636 20.5L46.3636 20.5L46.3636 47.5L31.3636 47.5L31.3636 20.5Z" fill="#3B996D" anim:opacity="1[2.1:2.5:0:ease-in-out]"></path>
                                            <g id="Union">
                                                <mask id="path-14-inside-1_1_16" fill="white">
                                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M35.3182 10C34.3391 10 33.5455 10.7937 33.5455 11.7727C33.5455 12.7518 34.3391 13.5455 35.3182 13.5455L35.3182 15.3182L33 15.3182C31.3432 15.3182 30 16.6613 30 18.3182L30 46C30 47.6569 31.3432 49 33 49L44.7273 49C46.3841 49 47.7273 47.6569 47.7273 46L47.7273 18.3182C47.7273 16.6613 46.3841 15.3182 44.7273 15.3182L42.4091 15.3182L42.4091 13.5455C43.3882 13.5455 44.1818 12.7518 44.1818 11.7727C44.1818 10.7937 43.3882 10 42.4091 10L35.3182 10Z"></path>
                                                </mask>
                                                <path d="M35.3182 13.5455L36.8182 13.5455L36.8182 12.0455L35.3182 12.0455L35.3182 13.5455ZM35.3182 15.3182L35.3182 16.8182L36.8182 16.8182L36.8182 15.3182L35.3182 15.3182ZM42.4091 15.3182L40.9091 15.3182L40.9091 16.8182L42.4091 16.8182L42.4091 15.3182ZM42.4091 13.5455L42.4091 12.0455L40.9091 12.0455L40.9091 13.5455L42.4091 13.5455ZM35.0455 11.7727C35.0455 11.6221 35.1676 11.5 35.3182 11.5L35.3182 8.5C33.5107 8.5 32.0455 9.96525 32.0455 11.7727L35.0455 11.7727ZM35.3182 12.0455C35.1676 12.0455 35.0455 11.9233 35.0455 11.7727L32.0455 11.7727C32.0455 13.5802 33.5107 15.0455 35.3182 15.0455L35.3182 12.0455ZM33.8182 13.5455L33.8182 15.3182L36.8182 15.3182L36.8182 13.5455L33.8182 13.5455ZM35.3182 13.8182L33 13.8182L33 16.8182L35.3182 16.8182L35.3182 13.8182ZM33 13.8182C30.5147 13.8182 28.5 15.8329 28.5 18.3182L31.5 18.3182C31.5 17.4898 32.1716 16.8182 33 16.8182L33 13.8182ZM28.5 18.3182L28.5 46L31.5 46L31.5 18.3182L28.5 18.3182ZM28.5 46C28.5 48.4853 30.5147 50.5 33 50.5L33 47.5C32.1716 47.5 31.5 46.8284 31.5 46L28.5 46ZM33 50.5L44.7273 50.5L44.7273 47.5L33 47.5L33 50.5ZM44.7273 50.5C47.2126 50.5 49.2273 48.4853 49.2273 46L46.2273 46C46.2273 46.8284 45.5557 47.5 44.7273 47.5L44.7273 50.5ZM49.2273 46L49.2273 18.3182L46.2273 18.3182L46.2273 46L49.2273 46ZM49.2273 18.3182C49.2273 15.8329 47.2126 13.8182 44.7273 13.8182L44.7273 16.8182C45.5557 16.8182 46.2273 17.4898 46.2273 18.3182L49.2273 18.3182ZM44.7273 13.8182L42.4091 13.8182L42.4091 16.8182L44.7273 16.8182L44.7273 13.8182ZM43.9091 15.3182L43.9091 13.5455L40.9091 13.5455L40.9091 15.3182L43.9091 15.3182ZM42.6818 11.7727C42.6818 11.9234 42.5597 12.0455 42.4091 12.0455L42.4091 15.0455C44.2166 15.0455 45.6818 13.5802 45.6818 11.7727L42.6818 11.7727ZM42.4091 11.5C42.5597 11.5 42.6818 11.6221 42.6818 11.7727L45.6818 11.7727C45.6818 9.96525 44.2166 8.5 42.4091 8.5L42.4091 11.5ZM35.3182 11.5L42.4091 11.5L42.4091 8.5L35.3182 8.5L35.3182 11.5Z" fill="#A0AFD2" mask="url(#path-14-inside-1_1_16)"></path>
                                            </g>
                                        </g>
                                        <g id="chef_head" anim:y="0[0.5:0.6:2:ease-in-out][0.6:0.7:0:ease-in-out][1.2:1.3:4:ease-in-out][1.3:1.4:0:ease-in-out][5.2:5.5:4:ease-in-out][5.5:5.8:0:ease-in-out][5.8:6:-4:ease-in-out][6:6.2:0:ease-in-out]">
                                            <g id="Rectangle 5">
                                                <rect x="25" y="71" width="80" height="39" rx="8" fill="#B8C0D6"></rect>
                                                <rect x="26" y="72" width="78" height="37" rx="7" stroke="#4167C3" stroke-opacity="0.2" stroke-width="2"></rect>
                                            </g>
                                            <circle id="Ellipse 18" cx="41" cy="91" r="9" fill="#4168C4" anim:y="0[5.2:5.6:4:ease-in-out][5.6:6:-2:ease-in-out][6:6.3:0:ease-in-out]"></circle>
                                            <ellipse id="Ellipse 19" cx="91" cy="90.5" rx="7" ry="7.5" fill="#4168C4" anim:y="0[5.2:5.6:-4:ease-in-out][5.6:6:2:ease-in-out][6:6.3:0:ease-in-out]"></ellipse>
                                            <path id="Vector 1" d="M55 91H57.6667L60.0303 88L62.3939 91L64.7576 94L67.1212 91L69.4848 88L71.8485 91L74.2121 94L76.5758 91H79" stroke="#4168C4" stroke-width="4" anim:x="0[5.2:5.6:-10:ease-in-out][5.6:6:10:ease-in-out][6:6.4:0:ease-in-out]"></path>
                                        </g>
                                        <g id="oileyes" anim:opacity="0[2.4:2.8:1:ease-in-out][3.9:4.2:0:ease-in-out]">
                                            <mask id="mask1_1_16" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="32" y="82" width="66" height="18">
                                                <path id="Union_2" fill-rule="evenodd" clip-rule="evenodd" d="M41 100C45.9706 100 50 95.9706 50 91C50 86.0294 45.9706 82 41 82C36.0294 82 32 86.0294 32 91C32 95.9706 36.0294 100 41 100ZM91 98C94.866 98 98 94.6421 98 90.5C98 86.3579 94.866 83 91 83C87.134 83 84 86.3579 84 90.5C84 94.6421 87.134 98 91 98Z" fill="#4168C4"></path>
                                            </mask>
                                            <g mask="url(#mask1_1_16)">
                                                <rect id="oillevel" x="23" y="99" width="80" height="23" fill="#3B996D" anim:y="0[2.8:3.8:-20:ease-in-out]"></rect>
                                            </g>
                                        </g>
                                    </g>
                                </svg>
                            </svg-animate>
                        <p>Cooking something up...</p>
                        <div class="progress" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                            <div class="progress-bar progress-bar-striped bg-success progress-bar-animated" id="gptProgressBar"></div>
                        </div>
                        <script src="https://cdn.jsdelivr.net/npm/@figmania/loader/build/index.umd.js"></script>
                    </div>
                </div>
            </div>
        </div>

        <div class="container mt-4">
            <h4><i class="bi bi-clock-history"></i> Results history</h4>
            <ul id="savedResults" class="list-group mt-3 mb-1">
                <!-- Saved prompts will be populated here -->
            </ul>
            <div class="d-flex justify-content-center">
                <button id="loadMoreBtn" class="btn btn-tertiary" style="">Load more</button>
            </div>
        </div>

        <!-- Modal for viewing the full prompt or the newly generated GPT-4 response -->
        <div class="modal fade" id="promptModal" tabindex="-1" aria-labelledby="promptModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="promptModalLabel">Recipe result</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="promptModalContent">
                        <!-- Full prompt content will go here -->
                    </div>
                    <div class="modal-footer justify-content-between">
                        <button type="button" class="btn btn-outline-danger" data-bs-dismiss="modal" id="deletePromptBtn">Delete recipe <i class="bi bi-trash3"></i></button>
                        <button type="button" class="btn btn-tertiary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div aria-live="polite" aria-atomic="true" class="position-relative">
            <div class="toast-container position-fixed bottom-0 end-0 p-3">
                <div id="pageToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="5000">
                    <div class="d-flex">
                        <div class="toast-body">
                            <!-- Text will be set dynamically -->
                        </div>
                        <button type="button" class="btn-close me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Bar -->
    <div id="floatingActionBar" class="fixed-bottom mb-4 bg-text-primary" style="display: none; z-index: 99;">
        <div class="d-flex gap-2 justify-content-center">
            <button id="deleteAllBtn" type="button" class="btn btn-danger"><i class="bi bi-trash3"></i></button>
            <button id="tagAllBtn" type="button" class="btn btn-secondary"><i class="bi bi-tags"></i></button>
            <button id="moveAllBtn" type="button" class="btn btn-secondary"><i class="bi bi-arrow-down-up"></i></button>
            <button id="deselectAllBtn" type="button" class="btn btn-tertiary"><span id="selectedCountBadge" class="my-auto">0 items</span><i class="bi bi-x-lg ms-2"></i></button>
        </div>
    </div>

    <!-- Previous Item Modal -->
    <div class="modal fade" id="deletedItemsModal" tabindex="-1" aria-labelledby="deletedItemsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title" id="deletedItemsModalLabel">Restore a previous item</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    
                    {% if deleted_items|length > 0 %}
                    <div class="list-group list-group-flush" role="group" aria-label="Deleted items selection">
                        {% for previousItem in deleted_items %}
                        <button type="button" class="list-group-item list-group-item-action" onclick="restoreItem('{{ previousItem.name }}')">{{ previousItem.name }}</button>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="m-3 text-body-secondary">Nothing here.</p>
                    {% endif %}
                    <p class="mx-3 text-body-secondary"><small>You will need to <a href=".">Reload</a> to see items you just deleted.</small></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-tertiary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Tag Selection Modal -->
    <div class="modal fade" id="tagSelectionModal" tabindex="-1" aria-labelledby="tagSelectionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title" id="tagSelectionModalLabel">Tag selected items</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="list-group list-group-flush" role="group" aria-label="Tag selection">
                        <button type="button" class="list-group-item list-group-item-action" onclick="tagAllSelectedItems('Fresh')">Fresh</button>
                        <button type="button" class="list-group-item list-group-item-action" onclick="tagAllSelectedItems('Old')">Old</button>
                        <button type="button" class="list-group-item list-group-item-action" onclick="tagAllSelectedItems('Frozen')">Frozen</button>
                        <button type="button" class="list-group-item list-group-item-action" onclick="tagAllSelectedItems('Low')">Low</button>
                        <button class="list-group-item text-danger list-group-item-action" onclick="removeAllTagsForSelected()">Remove tags<i class="bi bi-file-x ms-2"></i></button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-tertiary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Category Selection Modal -->
    <div class="modal fade" id="categorySelectionModal" tabindex="-1" aria-labelledby="categorySelectionModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title" id="categorySelectionModalLabel">Move items to category</h6>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="list-group list-group-flush" role="group" id="newCategorySelect">
                        <button type="button" class="list-group-item list-group-item-action" value="Ungrouped">Not grouped</button>
                        <button type="button" class="list-group-item list-group-item-action" value="Staples">🧀 Dairy and stock</button>
                        <button type="button" class="list-group-item list-group-item-action" value="Oils">🧂 Oils and seasoning</button>
                        <button type="button" class="list-group-item list-group-item-action" value="Pantry">🥫 Canned and bagged</button>
                        <button type="button" class="list-group-item list-group-item-action" value="Vegetables">🥕 Vegetables</button>
                        <button type="button" class="list-group-item list-group-item-action" value="Fruits">🍒 Fruits</button>
                        <button type="button" class="list-group-item list-group-item-action" value="Meats">🍖 Meats</button>
                        <button type="button" class="list-group-item list-group-item-action" value="Baking">🍞 Flours and baking</button>
                        <button type="button" class="list-group-item list-group-item-action" value="Alcohol">🍷 Alcohol</button>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-tertiary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmationModal" tabindex="-1" aria-labelledby="deleteConfirmationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteConfirmationModalLabel">Delete selected items?</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete all selected items?
                    <div class="mt-3 d-flex justify-content-end">
                        <button type="button" class="btn btn-danger me-2" id="confirmDeleteAll">Delete all<i class="bi bi-trash3 ms-2"></i></button>
                        <button type="button" class="btn btn-tertiary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>
	    function executeAjaxRequest(url, type, data, onSuccess, onError) {
		    $.ajax({
			    url,
			    type,
			    contentType: 'application/json',
			    data: JSON.stringify(data),
			    cache: false,
			    success: onSuccess,
			    error: (xhr, status, error) => console.error(`Error: ${error}`)
		    });
        }

        function restoreItem(item_name) {
            executeAjaxRequest(`/restore-item`, 'POST', { item_name,}, () => {
                console.log(item_name + ' restored.');
                location.reload(true)
            });
        }

	    function savePrompt(content, items, callback) {
		    executeAjaxRequest('/save-prompt', 'POST', { content, items }, (response) => {
			    console.log('Prompt saved successfully');
			    if (typeof callback === "function") {
				    callback(response.prompt_id);
			    }
		    });
	    }

	    function renderPrompts(receivedPrompts) {
		    const savedResultsList = document.getElementById('savedResults');
		    receivedPrompts.forEach((prompt) => {
			    const listItem = document.createElement('button');
			    listItem.className = 'py-3 list-group-item list-group-item-action text-truncate';
			    listItem.id = 'saved-'+prompt.id
			    listItem.setAttribute('data-bs-toggle', 'modal');
			    listItem.setAttribute('data-bs-target', '#promptModal');

			    const previewText = findFirstHeadingOrBold(prompt.content);
			    listItem.textContent = previewText;
			    listItem.onclick = () => {
				    document.getElementById('promptModalContent').innerHTML = formatContent(prompt.content);
				    document.getElementById('deletePromptBtn').onclick = () => deletePrompt(prompt.id);
				    populateItemsList(prompt.items, prompt.id);
			    };
			    savedResultsList.appendChild(listItem);
		    });
	    }

        let currentOffset = 0;

        function loadSavedPrompts(offset = 0, limit = 10) {
            executeAjaxRequest(`/get-prompts?offset=${offset}&limit=${limit}`, 'GET', {}, (receivedPrompts) => {
                renderPrompts(receivedPrompts);
                currentOffset += receivedPrompts.length;
                if (receivedPrompts.length < limit) {
                    document.getElementById('loadMoreBtn').style.display = 'none';
                } else {
                    document.getElementById('loadMoreBtn').style.display = 'inline-block';
                }
            });
        }

        document.getElementById('loadMoreBtn').addEventListener('click', function () {
            loadSavedPrompts(currentOffset, 10);
        });

	    function populateItemsList(itemsString, promptId) {
		    const itemsContainer = document.createElement('div');
		    itemsContainer.className = 'items-container mt-4 gap-2 row row-cols-auto';

		    itemsString.split(',').forEach((itemName) => {
			    itemName = itemName.trim();
			    if (itemName) {
				    const itemSpan = document.createElement('span');
				    itemSpan.className = 'py-2 item-span border border-secondary-subtle rounded-pill col';
				    itemSpan.textContent = itemName;

				    const deleteButton = document.createElement('button');
				    deleteButton.innerHTML = '<i class="bi bi-trash3"></i>';
				    deleteButton.className = 'btn btn-outline-danger btn-sm ms-2';
				    deleteButton.setAttribute('data-item-name', itemName);
				    deleteButton.onclick = (event) => deleteItemFromPrompt(promptId, itemName, event);

				    itemSpan.appendChild(deleteButton);
				    itemsContainer.appendChild(itemSpan);
			    }
		    });

		    if (itemsContainer.children.length > 0) {
			    const itemHeader = document.createElement('h5');
			    itemHeader.textContent = 'Remove used items?';
			    itemHeader.className = 'col-12';
			    itemsContainer.insertBefore(itemHeader, itemsContainer.firstChild);
		    }
		    document.getElementById('promptModalContent').appendChild(itemsContainer);
	    }

        function initializeForm() {
            $('#askGptForm').submit((event) => {
                event.preventDefault();
                const selectedItems = document.getElementById('selectedItems').value;
                const region = document.getElementById('regionSelect').value;
                const modifier = document.getElementById('modifierSelect').value;
                const specifications = document.getElementById('specifications').value;
                const selectedPrompt = document.querySelector('input[name="options"]:checked').value;

                executeAjaxRequest('/ask-gpt4', 'POST', {
                    selected_items: selectedItems,
                    selected_prompt: selectedPrompt,
                    region: region,
                    modifier: modifier,
                    specifications: specifications
                }, (response) => {
                    savePrompt(response.gpt_response, selectedItems, (promptId) => {
                        const newItem = document.createElement('li');
                        newItem.className = 'py-3 list-group-item list-group-item-action text-truncate';
                        newItem.id = 'saved-' + promptId;
                        newItem.setAttribute('data-bs-toggle', 'modal');
                        newItem.setAttribute('data-bs-target', '#promptModal');
                        const previewText = findFirstHeadingOrBold(response.gpt_response);
                        newItem.textContent = previewText;
                        newItem.onclick = () => {
                            document.getElementById('promptModalContent').innerHTML = formatContent(response.gpt_response);
                            document.getElementById('deletePromptBtn').onclick = () => deletePrompt(promptId);
                            populateItemsList(selectedItems, promptId);
                        };


                        const savedResultsList = document.getElementById('savedResults');
                        savedResultsList.insertBefore(newItem, savedResultsList.firstChild);

                        document.getElementById('promptModalContent').innerHTML = formatContent(response.gpt_response);
                        document.getElementById('deletePromptBtn').onclick = () => deletePrompt(promptId);
                        populateItemsList(selectedItems, promptId);
                        const myModal = new bootstrap.Modal(document.getElementById('promptModal'));
                        myModal.show();

                        ['gptLoader', 'buttonLoadingIndicator', 'buttonStars'].forEach(id => {
                            document.getElementById(id).style.display = (id === 'buttonStars') ? 'inline-block' : 'none';
                        });
                        document.getElementById('askGptButton').disabled = false;
                    });
                });
            });
        }


	    function deleteItemFromPrompt(promptId, itemName, event) {
		    event.preventDefault();
		    executeAjaxRequest('/delete-item-from-prompt', 'POST', { prompt_id: promptId, item_name: itemName }, (response) => {
			    event.target.closest('.item-span').remove();
			    document.querySelectorAll(`input[type='checkbox'][value='${itemName}']`).forEach((checkbox) => checkbox.closest('li').remove());
			    updateBadgeNumbers();
		    });
	    }

        function findFirstHeadingOrBold(content) {
		    const headingRegex = /^(#+)\s*(.*)/m;
		    const boldRegex = /\*\*(.*?)(?::|\*\*)/;
		    const headingMatch = content.match(headingRegex);
		    const boldMatch = content.match(boldRegex);
            let previewText = headingMatch ? headingMatch[2] : (boldMatch ? boldMatch[1] : content.split('\n', 1)[0]);
            previewText = previewText.replace(/1\. /, '').replace(/Recipe 1: /, '');
		    return previewText;
	    }

	    function deletePrompt(promptId) {
		    executeAjaxRequest(`/delete-prompt/${promptId}`, 'POST', {}, (response) => {
			    console.log('Prompt deleted successfully');
			    location.reload(true)
		    });
	    }

	    function saveAccordionState(accordionId, isExpanded) {
		    localStorage.setItem(accordionId, isExpanded);
	    }

	    function restoreAccordionStates() {
		    document.querySelectorAll('.accordion-collapse').forEach(accordion => {
			    const accordionId = '#' + accordion.id;
			    const isExpanded = localStorage.getItem(accordionId) === 'true';
			    if (isExpanded) {
				    new bootstrap.Collapse(accordion, { toggle: false }).show();
			    } else {
				    new bootstrap.Collapse(accordion, { toggle: false }).hide();
			    }
		    });
	    }

	    document.addEventListener('DOMContentLoaded', function () {
            restoreAccordionStates();
		    document.querySelectorAll('.accordion-button').forEach(button => {
			    button.addEventListener('click', function() {
				    const accordionId = this.dataset.bsTarget;
				    const isExpanded = this.getAttribute('aria-expanded') === 'true';
				    saveAccordionState(accordionId, isExpanded);
			    });
		    });
	    });

	    const categories = ['Ungrouped', 'Oils', 'Staples', 'Pantry', 'Vegetables', 'Meats', 'Fruits', 'Baking', 'Alcohol'];
	    categories.forEach(category => {
		    const element = document.getElementById(category);
		    initializeSortable(element);
	    });

	    function initializeSortable(element) {
		    new Sortable(element, {
			    group: 'shared',
			    delay: 50,
			    delayOnTouchOnly: true,
			    animation: 150,
                filter: ".btn",
                handle: ".dragHandle",
			    ghostClass: "list-group-item-dark",
			    dragClass: "list-group-item-primary",
			    chosenClass: "list-group-item-primary",
			    emptyInsertThreshold: 32,
			    onStart: (evt) => {
				    lastMovedItem = {
					    id: evt.item.getAttribute('data-id'),
					    name: evt.item.querySelector('label').textContent,
					    from: evt.from.getAttribute('data-category'),
					    element: evt.item
				    };
			    },
			    onEnd: (evt) => {
				    const newCategory = evt.item.parentNode.getAttribute('data-category');
				    const itemOrders = Array.from(evt.item.parentNode.children).map((el, index) => {
					    return { id: el.getAttribute('data-id'), order: index, category: newCategory };
				    });
				    updateCategoryAndOrder(itemOrders);
				    showToast(`${lastMovedItem.name} moved to ${newCategory}`);
				    lastMovedItem.to = newCategory;
			    }
		    });
	    }

	    let lastMovedItem = null;

        function showToast(message) {
		    const toastEl = document.getElementById('pageToast');
            toastEl.querySelector('.toast-body').textContent = message;
		    new bootstrap.Toast(toastEl).show();
	    }

	    document.getElementById('askGptForm').onsubmit = function() {
		    setSelectedItems();
		    ['gptLoader', 'buttonLoadingIndicator', 'buttonStars'].forEach(id => {
			    document.getElementById(id).style.display = id === 'buttonStars' ? 'none' : 'inline-block';
		    });
            document.getElementById('askGptButton').disabled = true;
            promptProgress();
	    };

	    function updateCategoryAndOrder(itemOrders) {
		    executeAjaxRequest('/update-items', 'POST', { items: itemOrders }, (response) => {
			    console.log('Items updated successfully');
			    updateBadgeNumbers();
		    });
        }

        function moveAllSelectedItemsToCategory(newCategory) {
            const selectedCheckboxes = document.querySelectorAll('.form-check-input:checked');
            const itemOrders = Array.from(selectedCheckboxes).map((checkbox, index) => {
                const itemId = checkbox.closest('li').getAttribute('data-id');
                return {
                    id: itemId,
                    order: index, // Update this to instead index items starting from 0
                    category: newCategory
                };
            });

            moveItemsToNewCategoryUI(itemOrders, newCategory);
            showToast('Items moved');
        }

        function moveItemsToNewCategoryUI(itemOrders, newCategory) {
            itemOrders.forEach(itemOrder => {
                const itemElement = document.querySelector(`li[data-id='${itemOrder.id}']`);
                if (itemElement) {
                    const newCategoryUl = document.getElementById(newCategory);
                    if (newCategoryUl) {
                        newCategoryUl.insertBefore(itemElement, newCategoryUl.firstChild) ? newCategoryUl.firstChild : newCategoryUl.appendChild(itemElement);
                    }
                }
                updateCategoryAndOrder(itemOrders);
            });
        }


	    function updatePromptAccordion() {
		    const selectedPromptKey = document.querySelector('input[name="options"]:checked').value;
		    const promptDetails = {
		    {% for key, prompt in prompts.items() %}
		    "{{ key }}":"{{ prompt }}",
		    {% endfor %}
		    };
		    document.getElementById('promptDetails').textContent = promptDetails[selectedPromptKey];
	    }

	    function selectAll(listId) {
		    const listItems = document.getElementById(listId).getElementsByTagName('input');
            Array.from(listItems).forEach(item => item.checked = true);
            updateFloatingActionBar();
            updateSelectedCount();
	    }

	    function selectNone(listId) {
		    const listItems = document.getElementById(listId).getElementsByTagName('input');
            Array.from(listItems).forEach(item => item.checked = false);
            updateFloatingActionBar();
            updateSelectedCount();
	    }

	    function setSelectedItems() {
		    const selected = Array.from(document.querySelectorAll('.form-check-input:checked')).map(checkbox => checkbox.value);
		    document.getElementById('selectedItems').value = selected.join(', ');
	    }

	    function deleteItem(itemId, event) {
		    event.preventDefault();
		    executeAjaxRequest(`/delete/${itemId}`, 'POST', {}, (response) => {
			    document.querySelector(`li[data-id='${itemId}']`)?.remove();
			    document.querySelector(`button[data-item-id='${itemId}']`)?.closest('span').remove();
			    updateBadgeNumbers();
		    });
	    }

	    function formatContent(content) {
		    return content.replace(/^###### (.*$)/gim, '<h6>$1</h6>')
			    .replace(/^##### (.*$)/gim, '<h5>$1</h5>')
			    .replace(/^#### (.*$)/gim, '<h4>$1</h4>')
			    .replace(/^### (.*$)/gim, '<h3>$1</h3>')
			    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
			    .replace(/^# (.*$)/gim, '<h1>$1</h1>')
			    .replace(/\n/g, '<br>')
			    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
	    }

	    function updateBadgeNumbers() {
		    categories.forEach(category => {
			    const count = document.getElementById(category).children.length;
			    const badge = document.querySelector(`#heading${category} .badge`);
			    if (badge) badge.textContent = count;
		    });
	    }

	    let itemTags = {};

	    function toggleTag(event, itemId, tag) {
		    event.preventDefault();
		    if (!itemTags[itemId]) {
			    itemTags[itemId] = new Set();
		    }
		    if (tag === 'Fresh' && itemTags[itemId].has('Old')) {
			    itemTags[itemId].delete('Old');
		    } else if (tag === 'Old' && itemTags[itemId].has('Fresh')) {
			    itemTags[itemId].delete('Fresh');
		    } else if (tag === 'Fresh' && itemTags[itemId].has('Frozen')) {
			    itemTags[itemId].delete('Frozen');
		    } else if (tag === 'Frozen' && itemTags[itemId].has('Fresh')) {
			    itemTags[itemId].delete('Fresh');
		    }

		    if (itemTags[itemId].has(tag)) {
			    itemTags[itemId].delete(tag);
		    } else {
			    itemTags[itemId].add(tag);
		    }
		    updateTags(itemId);
	    }

	    function initializeTags() {
		    {% for category, items in items_by_category.items() %}
			    {% for item in items %}
				    itemTags['{{ item['id'] }}'] = new Set({{ (item['tags'] or []) | tojson | safe }});
				    updateTags('{{ item['id'] }}');
			    {% endfor %}
		    {% endfor %}
	    }

        function updateDropdownActiveClass(itemId) {
            const itemTagsSet = itemTags[itemId] || new Set();

            document.querySelectorAll(`.dropdown-item[data-item-id='${itemId}']`).forEach(dropdownItem => {
			    const tag = dropdownItem.getAttribute('data-tag');
			    let checkIcon = dropdownItem.querySelectorAll('.bi')

			    if (checkIcon) {
				    checkIcon.forEach(i => { i.remove() })
                }
                if (itemTagsSet.has(tag)) {
				    dropdownItem.insertAdjacentHTML("beforeend",'<i class="bi bi-check ms-2"></i>')
                }
            });
        }

        let tagUpdateBuffer = {};
        let bufferTimeout = null;
        const bufferDelay = 500;

	    function updateTags(itemId) {
		    let tagsContainer = document.querySelector(`#tags-${itemId}`);
		    if (tagsContainer) {
			    tagsContainer.innerHTML = '';
			    if (itemTags[itemId]) {
				    let tags = [];
				    itemTags[itemId].forEach(tag => {
					    let badge = document.createElement('span');
					    badge.innerText = tag;
					    badge.classList.add('badge', 'me-1');
					    if (tag === 'Fresh') {
						    badge.classList.add('bg-success-subtle','text-success-emphasis')
					    }
					    if (tag === 'Old') {
						    badge.classList.add('bg-danger-subtle','text-danger-emphasis')
					    }
					    if (tag === 'Low') {
						    badge.classList.add('bg-warning-subtle','text-warning-emphasis')
					    }
					    if (tag === 'Frozen') {
						    badge.classList.add('bg-info-subtle','text-info-emphasis')
					    }
					    tagsContainer.appendChild(badge);
					    tags.push(tag);
				    });

				    tagUpdateBuffer[itemId] = tags;

                    clearTimeout(bufferTimeout);
                    bufferTimeout = setTimeout(() => {
                        sendTagUpdates();
                    }, bufferDelay);
			    }
                updateDropdownActiveClass(itemId);
		    } else {
			    console.error('Tags container not found for:', itemId);
		    }

		    }

        function sendTagUpdates() {
            if (Object.keys(tagUpdateBuffer).length > 0) {
                executeAjaxRequest('/update-item-tags-batch', 'POST', { updates: tagUpdateBuffer }, (response) => {
                    console.log('Tags updated successfully');
                });
                tagUpdateBuffer = {};
            }
        }

        function startEditItem(itemId) {
            const itemElement = document.querySelector(`li[data-id='${itemId}']`);
            const itemNameElement = itemElement.querySelector('.form-check-label');
            const originalName = itemNameElement.firstChild.textContent.trim()

            const inputElement = document.createElement('input');
            inputElement.type = 'text';
            inputElement.value = originalName;
            inputElement.className = 'form-control edit-item-input';
            inputElement.onblur = () => submitEditItem(itemId, inputElement.value, originalName);
            inputElement.addEventListener("keypress", function() {
                if (event.key === "Enter") {
                    submitEditItem(itemId, inputElement.value, originalName);
                }
            });

            itemNameElement.replaceChild(inputElement, itemNameElement.firstChild);
            inputElement.focus();
        }

        function submitEditItem(itemId, newName, originalName) {
            const itemNameElement = document.querySelector(`li[data-id='${itemId}'] .form-check-label`);
            const tagsContainer = itemNameElement.querySelector('.tags-container');

            if (newName === originalName) {
                itemNameElement.textContent = originalName;
                itemNameElement.appendChild(tagsContainer);
                return;
            }

            executeAjaxRequest(`/update-item-name/${itemId}`, 'POST', { new_name: newName }, (response) => {
                itemNameElement.textContent = newName.length > 64 ? `${newName.substring(0, 32)}...` : newName;
                itemNameElement.appendChild(tagsContainer);
                showToast('Item name updated successfully');
            }, (error) => {
                itemNameElement.textContent = originalName.length > 64 ? `${originalName.substring(0, 32)}...` : originalName;
                itemNameElement.appendChild(tagsContainer);
            });
        }

        function randomizeSelections() {
            const regionSelect = document.getElementById('regionSelect');
            const modifierSelect = document.getElementById('modifierSelect');
            const regions = regionSelect.options;
            const modifiers = modifierSelect.options;

            regionSelect.selectedIndex = Math.floor(Math.random() * regions.length);
            modifierSelect.selectedIndex = Math.floor(Math.random() * modifiers.length);
	    }

	    window.onload = function() {
		    document.getElementById("itemInput").focus();
	    };

	    $(document).ready(() => {
		    initializeForm();
		    initializeTags();
            for (const itemId of Object.keys(itemTags)) {
                updateDropdownActiveClass(itemId);
            }
        });

        $(document).ready(function () {
            // Check for checkbox changes to toggle the floating action bar
            $('.form-check-input').change(function () {
                updateFloatingActionBar();
            });

            // Delete All Items
            $('#deleteAllBtn').click(function () {
                // Open the modal instead of showing a confirmation dialog
                $('#deleteConfirmationModal').modal('show');
            });

            // Action for the "Delete" button in the modal
            $('#confirmDeleteAll').click(function () {
                // Perform the deletion of checked items
                $('.form-check-input:checked').each(function () {
                    deleteItem($(this).closest('li').data('id'), event);
                    $(this).prop('checked', false);
                });
                updateFloatingActionBar();
                $('#deleteConfirmationModal').modal('hide');
                showToast('Items deleted');
            });

            // Tag All Items
            $('#tagAllBtn').click(function () {
                $('#tagSelectionModal').modal('show');
            });

            // Move all
            $('#moveAllBtn').click( function () {
                const selectedItems = document.querySelectorAll('.form-check-input:checked');
                const itemIds = Array.from(selectedItems).map(item => item.getAttribute('data-item-id'));
                // Store itemIds in a global variable or use a data attribute on the Move button
                $('#categorySelectionModal').modal('show');
            });

            // Deselect All Items
            $('#deselectAllBtn').click(function () {
                $('.form-check-input:checked').prop('checked', false);
                updateFloatingActionBar();
            });

            document.querySelectorAll('#newCategorySelect .list-group-item').forEach(button => {
                button.addEventListener('click', function () {
                    const newCategory = this.getAttribute('value');
                    moveAllSelectedItemsToCategory(newCategory);
                    $('#categorySelectionModal').modal('hide');
                });
            });


            // Function to update the visibility of the floating action bar
        });

        function updateFloatingActionBar() {
            if ($('.form-check-input:checked').length > 0) {
                $('#floatingActionBar').fadeIn(200);
            } else {
                $('#floatingActionBar').fadeOut(200);
            }
        }

        function updateSelectedCount() {
            const selectedItems = document.querySelectorAll('.form-check-input:checked').length;
            document.getElementById('selectedCountBadge').textContent = String(selectedItems + " items");
        }

        // Call this function whenever an item's checkbox is clicked
        document.querySelectorAll('.form-check-input').forEach(item => {
            item.addEventListener('change', updateSelectedCount);
        });


        function tagAllSelectedItems(tag) {
            $('.form-check-input:checked').each(function () {
                const itemId = $(this).closest('li').attr('data-id');
                toggleTagForAll(itemId, tag);
            });
            $('#tagSelectionModal').modal('hide');
            showToast("Items tagged")
        }


        function toggleTagForAll(itemId, newTag) {
            if (!itemTags[itemId]) {
                itemTags[itemId] = new Set();
            }

            // Enforce exclusivity rules
            const exclusivityRules = {
                'Fresh': ['Old', 'Frozen'],
                'Old': ['Fresh'],
                'Frozen': ['Fresh'],
            };

            // Remove tags based on the exclusivity rules
            if (exclusivityRules[newTag]) {
                exclusivityRules[newTag].forEach(tagToRemove => {
                    itemTags[itemId].delete(tagToRemove);
                });
            }

            // Now, add the new tag after removing conflicting tags
            itemTags[itemId].add(newTag);

            // Reflect changes in the UI
            updateTags(itemId);
        }

        function removeAllTagsForSelected() {
            $('.form-check-input:checked').each(function () {
                const itemId = $(this).closest('li').attr('data-id');
                itemTags[itemId].clear();
                updateTags(itemId);
            });
            $('#tagSelectionModal').modal('hide');
        }

	    document.addEventListener('DOMContentLoaded', function() {
		    loadSavedPrompts();
		    initializeAccordionButtons();
	    });

        function initializeAccordionButtons() {
            const collapseAllButton = document.getElementById('accordionCollapseButton');
            const expandAllButton = document.getElementById('accordionExpandButton');
            const accordions = document.querySelectorAll('.accordion-collapse');

            collapseAllButton.addEventListener('click', () => {
                accordions.forEach((accordion) => {
                    new bootstrap.Collapse(accordion, {
                        toggle: false
				    }).hide();
                    const accordionId = '#' + accordion.id;
                    saveAccordionState(accordionId, 'false');
                });
            });

            expandAllButton.addEventListener('click', () => {
                accordions.forEach((accordion) => {
                    new bootstrap.Collapse(accordion, {
                        toggle: false
				    }).show();
                    const accordionId = '#' + accordion.id;
                    saveAccordionState(accordionId, 'true');
                });
            });
        };

	    function toggleAdvancedSettings() {
		    advancedSettings = document.getElementById('advancedSettings');
            if (advancedSettings.style.display === 'none' || advancedSettings.style.display === '') {
			    advancedSettings.style.display = 'flex';
			    event.target.firstChild.classList.add('bi-gear-fill');
                event.target.firstChild.classList.remove('bi-gear');

            } else {
                advancedSettings.style.display = 'none';
                event.target.firstChild.classList.add('bi-gear');
                event.target.firstChild.classList.remove('bi-gear-fill');
		    }
        };

        function promptProgress() {
            const progressBar = document.getElementById('gptProgressBar');
            let width = 0;
            const totalTime = 40000;
            const intervalTime = 100;

            const interval = setInterval(() => {
                width += (intervalTime / totalTime) * 100;

                progressBar.style.width = width + '%';
                progressBar.setAttribute('aria-valuenow', width);

                if (width >= 100) {
                    clearInterval(interval);
                }
            }, intervalTime);
        }

    </script>
</body>
</html>